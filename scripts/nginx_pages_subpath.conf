server {
  listen 80;
  server_name _;
  index index.html;

  # Ensure /detpack-lab redirects to trailing slash.
  location = /detpack-lab {
    return 308 /detpack-lab/;
  }

  # GH Pages serves the site from a directory URL (trailing slash).
  # Make sure /detpack-lab/ resolves to the exported index.html without redirects.
  location = /detpack-lab/ {
    rewrite ^ /detpack-lab/index.html last;
  }

  # Serve a static export under a GitHub Pages-like basePath.
  # All requests under /detpack-lab/* are rewritten to /* within the exported folder.
  location ^~ /detpack-lab/ {
    root /usr/share/nginx/html;
    rewrite ^/detpack-lab/(.*)$ /$1 break;
    try_files $uri $uri/index.html /index.html;
  }
}
